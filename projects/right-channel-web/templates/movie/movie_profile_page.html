{% extends ../layout/layout.html %}
{% block content %}
  {% if params.get('movie') %}
    {% set movie = params.get('movie') %}
    <div class="row-fluid container-bordered default-margin default-padding">
      <div class="row-fluid default-margin">
        <div class="span3">
          <a>
            <img src="http://img3.douban.com/lpic/s11356673.jpg">
          </a>
          <div class="row-fluid default-margin">
            {% include ../modules/share.html %}
          </div>
        </div>
        
        <div class="span9">
          <div class="profile">
            <h2>
              {% from utilities import combine_titles %}
              {{ combine_titles(movie.get('title'), movie.get('original_title')) }}
              {% if movie.get('year') %}
                <small class="muted">
                  ({{ movie.get('year') }})
                </small>
              {% end %}
            </h2>
            {% if movie.get('directors') %}
              <p>
                <strong>导演:</strong> {{ ' / '.join(movie.get('directors')) }}
              </p>
            {% end %}
            {% if movie.get('casts') %}
              <p>
                <strong>主演:</strong> {{ ' / '.join(movie.get('casts')) }}
              </p>
            {% end %}
            {% if movie.get('genres') %}
              <p>
                <strong>类型:</strong> {{ ' / '.join(movie.get('genres')) }}
              </p>
            {% end %}
            {% if movie.get('countries') %}
              <p>
                <strong>地区:</strong> {{ ' / '.join(movie.get('countries')) }}
              </p>
            {% end %}
            {% if movie.get('aka') %}
              <p>
                <strong>又名:</strong> {{ ' / '.join(movie.get('aka')) }}
              </p>
            {% end %}
            {% if movie.get('douban') and 'rating' in movie.get('douban') %}
              <p>
                <strong>评分:</strong>
                <a href="{{ movie.get('douban').get('url') }}" title="豆瓣评分{{ movie.get('douban').get('rating') }}" class="douban-rating" target="_blank">
                  <i class="logo-platform logo-platform-douban"></i> {{ movie.get('douban').get('rating') }}
                </a>
              </p>
            {% end %}
            {% if movie.get('summary') %}
              <p>
                <strong>简介:</strong> {{ movie.get('summary') }}
              </p>
            {% end %}
          </div>
          
          <div class="row-fluid default-margin">
            {% if movie.get('resources') and movie.get('resources').get('online') and movie.get('resources').get('online').keys() %}
              <div class="btn-group pull-left">
                <button class="btn btn-small btn-primary"><i class="icon-play icon-white"></i> 立即观看</button>
                <button class="btn btn-small btn-primary dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                <ul class="dropdown-menu">
                  {% from settings import settings %}
                  {% for provider in movie.get('resources').get('online').keys() %}
                    <li>
                      <a href="{{ movie.get('resources').get('online').get(provider).get('url') }}" title="去{{ settings['providers'][provider]['name']}}观看" target="_blank">
                        <i class="logo-platform {{ settings['providers'][provider]['logo'] }}"></i> {{ settings['providers'][provider]['name']}}
                      </a>
                    </li>
                  {% end %}
                </ul>
              </div>
              
              <div class="btn-group pull-left">
                <button class="btn btn-small btn-primary"><i class="icon-play icon-white"></i> 立即下载</button>
                <button class="btn btn-small btn-primary dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                <ul class="dropdown-menu">
                  {% from settings import settings %}
                  {% for provider in movie.get('resources').get('online').keys() %}
                    <li>
                      <a href="{{ movie.get('resources').get('online').get(provider).get('url') }}" title="去{{ settings['providers'][provider]['name']}}观看" target="_blank">
                        <i class="logo-platform {{ settings['providers'][provider]['logo'] }}"></i> {{ settings['providers'][provider]['name']}}
                      </a>
                    </li>
                  {% end %}
                </ul>
              </div>
            {% else %}
              <div class="badge badge-warning pull-left">
                本片暂无在线资源，点击“想看”，系统会第一时间通知您！
              </div>
            {% end %}
            
            <div class="btn-group pull-right">
              {% if movie.get('to_watch') %}
                <button id="toWatch" data-id="{{ movie.get('_id') }}" data-current-status="marked" class="btn btn-small btn-info" title="已加入想看列表"> <i class="icon-eye-open icon-white"></i> 想看</button>
              {% else %}
                <button id="toWatch" data-id="{{ movie.get('_id') }}" data-current-status="unmarked" class="btn btn-small" title="加入想看列表"> <i class="icon-eye-open"></i> 想看</button>
              {% end %}
              {% if movie.get('watched') %}
                <button id="watched" data-id="{{ movie.get('_id') }}" data-current-status="marked" class="btn btn-small btn-success" title="已加入已看列表"> <i class="icon-check icon-white"></i> 已看</button>
              {% else %}
                <button id="watched" data-id="{{ movie.get('_id') }}" data-current-status="unmarked" class="btn btn-small" title="加入已看列表"> <i class="icon-check"></i> 已看</button>
              {% end %}
              {% if movie.get('not_interested') %}
                <button id="notInterested" data-id="{{ movie.get('_id') }}" data-current-status="marked" class="btn btn-small btn-inverse" title="已标记为没兴趣"> <i class="icon-eye-close icon-white"></i> 没兴趣</button>
              {% else %}
                <button id="notInterested" data-id="{{ movie.get('_id') }}" data-current-status="unmarked" class="btn btn-small" title="标记为没兴趣"> <i class="icon-eye-close"></i> 没兴趣</button>
              {% end %}
            </div>
          </div>
        </div>
      </div>
    </div>
  {% end %}
{% end %}

{% block extra_scripts %}
  <script type="text/javascript" src="{{ static_url('js/jquery.cookie.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('js/utilities.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('js/user-action-on-movie.js') }}"></script>
  <script type="text/javascript">
    $(function() {
        $('#toWatch').click(function() {
            toggleToWatch($(this));
        });
        $('#watched').click(function() {
            toggleWatched($(this));
        });
        $('#notInterested').click(function() {
            toggleNotInterested($(this));
        });
    });
  </script>
{% end %}